<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard • Sabir Amin Real Estate Company LLC</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />

  <!-- Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- Shared UI Styles -->
  <link rel="stylesheet" href="app.css" />
</head>

<body data-page="dashboard">
  <div class="backdrop" id="backdrop"></div>

  <!-- Sidebar -->
  <nav class="sidebar" id="sidebar">
    <div class="logo">
      <div class="logo-icon"><i class="fas fa-gem"></i></div>
      <div class="logo-text">
        <div class="brand-name">Sabir Amin</div>
        <div class="brand-sub">Real Estate Company LLC</div>
      </div>
    </div>

    <div class="nav-section">
      <div class="nav-section-title">Main</div>
      <a href="index.html" class="nav-link active"><i class="fas fa-th-large"></i>Dashboard</a>
      <a href="properties.html" class="nav-link"><i class="fas fa-building"></i>Properties</a>
      <a href="rent-records.html" class="nav-link">
        <i class="fas fa-file-invoice-dollar"></i>Rent Records
        <span class="nav-badge" id="rentBadge">0</span>
      </a>
    </div>

    <div class="nav-section">
      <div class="nav-section-title">Finance</div>
      <a href="transactions.html" class="nav-link"><i class="fas fa-exchange-alt"></i>Transactions</a>
      <a href="recurring-expenses.html" class="nav-link"><i class="fas fa-redo"></i>Recurring Expenses</a>
      <a href="monthly-profit.html" class="nav-link"><i class="fas fa-chart-line"></i>Monthly Profit</a>
    </div>

    <div class="nav-section">
      <div class="nav-section-title">Reports</div>
      <a href="reports.html" class="nav-link"><i class="fas fa-chart-bar"></i>Reports</a>
    </div>

    <div class="nav-section">
      <div class="nav-section-title">System</div>
      <a href="settings.html" class="nav-link"><i class="fas fa-cog"></i>Settings</a>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="topbar">
      <div class="page-title">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px;">
          <button class="hamburger" id="menuBtn" title="Menu"><i class="fas fa-bars"></i></button>
          <h1>Dashboard</h1>
        </div>
        <p>
          Portfolio overview with key alerts, tasks, and performance trends.
          <span id="nowMeta" style="font-weight:900;"></span>
        </p>
      </div>

      <div class="header-actions">
        <div class="pill" title="Theme">
          <i class="fas fa-moon" style="color:var(--opal-lilac);"></i>
          <span>Theme: <strong id="themeLabel">Light</strong></span>
        </div>

        <div class="search-box" title="Search unit / owner / tenant / location">
          <i class="fas fa-search"></i>
          <input id="searchInput" type="text" placeholder="Search unit / owner / tenant / location…" />
        </div>

        <button class="btn btn-secondary btn-icon" id="themeBtn" title="Toggle dark mode">
          <i class="fas fa-circle-half-stroke"></i>
        </button>

        <a class="btn btn-secondary" id="exportBtn" href="#" title="Export snapshot (demo)">
          <i class="fas fa-file-export"></i> Export
        </a>

        <a class="btn btn-primary" href="properties.html" title="Go to Properties">
          <i class="fas fa-building"></i> Manage Properties
        </a>
      </div>
    </header>

    <!-- KPIs -->
    <section class="kpi-grid" aria-label="Key performance indicators">
      <div class="kpi-card card">
        <div class="kpi-row">
          <div>
            <div class="kpi-label">Total Units</div>
            <div class="kpi-value" id="kpiTotalUnits">—</div>
            <div class="kpi-sub">Studios & Apartments</div>
          </div>
          <div class="kpi-icon"><i class="fas fa-building"></i></div>
        </div>
        <div class="kpi-chip up"><i class="fas fa-arrow-up"></i> Live from Google Sheet</div>
      </div>

      <div class="kpi-card card">
        <div class="kpi-row">
          <div>
            <div class="kpi-label">Occupied</div>
            <div class="kpi-value" id="kpiOccupied">—</div>
            <div class="kpi-sub">Portfolio occupancy</div>
          </div>
          <div class="kpi-icon"><i class="fas fa-user-check"></i></div>
        </div>
        <div class="kpi-chip up"><i class="fas fa-chart-line"></i> Updated automatically</div>
      </div>

      <div class="kpi-card card">
        <div class="kpi-row">
          <div>
            <div class="kpi-label">Net Monthly Profit</div>
            <div class="kpi-value" id="kpiProfit">—</div>
            <div class="kpi-sub" id="kpiCurrency">QAR</div>
          </div>
          <div class="kpi-icon"><i class="fas fa-sack-dollar"></i></div>
        </div>
        <div class="kpi-chip up"><i class="fas fa-arrow-up"></i> Income − Expenses</div>
      </div>

      <div class="kpi-card card">
        <div class="kpi-row">
          <div>
            <div class="kpi-label">Overdue Payments</div>
            <div class="kpi-value" id="kpiOverdue">—</div>
            <div class="kpi-sub">Requires follow-up</div>
          </div>
          <div class="kpi-icon"><i class="fas fa-triangle-exclamation"></i></div>
        </div>
        <div class="kpi-chip down"><i class="fas fa-arrow-down"></i> Action required</div>
      </div>

      <div class="kpi-card card">
        <div class="kpi-row">
          <div>
            <div class="kpi-label">Contracts Expiring</div>
            <div class="kpi-value" id="kpiExpiring">—</div>
            <div class="kpi-sub">Within 90 days</div>
          </div>
          <div class="kpi-icon"><i class="fas fa-calendar-days"></i></div>
        </div>
        <div class="kpi-chip warn"><i class="fas fa-clock"></i> Review needed</div>
      </div>

      <div class="kpi-card card">
        <div class="kpi-row">
          <div>
            <div class="kpi-label">Maintenance</div>
            <div class="kpi-value" id="kpiMaintenance">—</div>
            <div class="kpi-sub">Open issues</div>
          </div>
          <div class="kpi-icon"><i class="fas fa-screwdriver-wrench"></i></div>
        </div>
        <div class="kpi-chip info"><i class="fas fa-wrench"></i> In progress</div>
      </div>
    </section>

    <!-- Charts -->
    <section class="charts-grid" aria-label="Charts section">
      <div class="card" style="min-height: 320px;">
        <div class="card-header">
          <div>
            <div class="card-title"><i class="fas fa-chart-line"></i> Monthly Profit Trend</div>
            <div class="card-sub">Track profit performance over time</div>
          </div>
          <div class="segmented" role="tablist" aria-label="Profit range">
            <button type="button" id="btn6m">6M</button>
            <button type="button" id="btn12m" class="active">12M</button>
            <button type="button" id="btnAll">All</button>
          </div>
        </div>
        <div class="card-body" style="height: 250px;">
          <canvas id="profitChart"></canvas>
        </div>
      </div>

      <div class="card" style="min-height: 320px;">
        <div class="card-header">
          <div>
            <div class="card-title"><i class="fas fa-chart-pie"></i> Income vs Expenses</div>
            <div class="card-sub">Current month snapshot</div>
          </div>
          <button class="btn btn-secondary btn-icon" id="refreshChartsBtn" title="Refresh charts">
            <i class="fas fa-rotate"></i>
          </button>
        </div>
        <div class="card-body" style="height: 250px;">
          <canvas id="incomeExpenseChart"></canvas>
        </div>
      </div>
    </section>

    <!-- Alerts + Tasks -->
    <section class="two-col" aria-label="Alerts and tasks">
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title"><i class="fas fa-bell"></i> Alerts & Notifications</div>
            <div class="card-sub">Items requiring attention</div>
          </div>
          <a class="btn btn-secondary" href="#" title="View all (placeholder)">
            <i class="fas fa-list"></i> View All
          </a>
        </div>
        <div class="card-body">
          <!-- Will be replaced by API -->
          <div class="list" id="alertsList">
            <div class="alert info">
              <div class="ic"><i class="fas fa-rotate"></i></div>
              <div>
                <h4>Loading alerts…</h4>
                <p>Fetching data from Google Sheet</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title"><i class="fas fa-clipboard-check"></i> Action Center</div>
            <div class="card-sub">Next steps for this week</div>
          </div>
          <button class="btn btn-secondary" id="addTaskBtn" title="Add a task (demo)">
            <i class="fas fa-plus"></i> Add
          </button>
        </div>
        <div class="card-body">
          <div class="list" id="taskList">
            <div class="task">
              <div class="task-left">
                <div class="task-dot"></div>
                <div>
                  <div class="task-title">Call overdue tenants and agree payment plan</div>
                  <div class="task-meta">Assigned: Admin • Priority: High</div>
                </div>
              </div>
              <div class="task-chip overdue">Overdue</div>
            </div>
            <div class="task">
              <div class="task-left">
                <div class="task-dot" style="background:var(--opal-lilac);box-shadow:0 0 0 4px rgba(149,117,205,0.14);"></div>
                <div>
                  <div class="task-title">Renew contracts expiring within 90 days</div>
                  <div class="task-meta">Assigned: Leasing • Priority: Medium</div>
                </div>
              </div>
              <div class="task-chip due">Due Soon</div>
            </div>
            <div class="task">
              <div class="task-left">
                <div class="task-dot" style="background:var(--opal-mint);box-shadow:0 0 0 4px rgba(105,240,174,0.14);"></div>
                <div>
                  <div class="task-title">Upload missing receipts to Drive folders</div>
                  <div class="task-meta">Assigned: Admin • Priority: Normal</div>
                </div>
              </div>
              <div class="task-chip ok">On Track</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Recent Properties Table -->
    <section class="card" aria-label="Recent properties">
      <div class="card-header">
        <div>
          <div class="card-title"><i class="fas fa-table"></i> Recent Properties</div>
          <div class="card-sub">Live view (from Google Sheet)</div>
        </div>
        <a href="properties.html" class="btn btn-secondary"><i class="fas fa-arrow-right"></i> View All</a>
      </div>

      <div class="card-body" style="padding:0;">
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Unit</th>
                <th>Type</th>
                <th>Owner</th>
                <th>Tenant</th>
                <th>Days Left</th>
                <th>Rent In</th>
                <th>Rent Out</th>
                <th>Profit</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="recentTbody">
              <tr>
                <td colspan="9" style="padding:18px 14px;color:var(--text-secondary);font-weight:900;">
                  Loading recent properties…
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Quick Actions FAB -->
  <div class="quick-actions">
    <button class="fab" id="fabBtn" title="Quick Add (demo)">
      <i class="fas fa-plus"></i>
    </button>
  </div>

  <!-- Shared App Logic -->
  <script src="app.js"></script>

  <!-- Optional: Profit range buttons (uses chart already rendered from API) -->
  <script>
    // Range switch is optional; it modifies the existing chart dataset in-memory.
    function setRange(range){
      const btn6m = document.getElementById("btn6m");
      const btn12m = document.getElementById("btn12m");
      const btnAll = document.getElementById("btnAll");
      if(!btn6m || !btn12m || !btnAll) return;

      btn6m.classList.remove("active");
      btn12m.classList.remove("active");
      btnAll.classList.remove("active");

      if(range === "6m") btn6m.classList.add("active");
      if(range === "12m") btn12m.classList.add("active");
      if(range === "all") btnAll.classList.add("active");

      // Uses window.__dashboardChartsData (set by app.js after API call)
      if(!window.__dashboardChartsData || !window.__dashboardChartsData.profitTrend) return;

      const fullLabels = window.__dashboardChartsData.profitTrend.labels || [];
      const fullData = window.__dashboardChartsData.profitTrend.data || [];

      // Access Chart instance via global (created in app.js)
      // If you want range switching based on API history, expand your API to return 6m/all sets.
      // Here we implement a safe slice for 6m and full for 12m.
      const canvas = document.getElementById("profitChart");
      if(!canvas) return;

      // Re-render charts with modified data by overwriting __dashboardChartsData then calling renderCharts()
      if(range === "6m"){
        window.__dashboardChartsData.profitTrend = {
          labels: fullLabels.slice(Math.max(0, fullLabels.length - 6)),
          data: fullData.slice(Math.max(0, fullData.length - 6))
        };
      } else if(range === "all") {
        // For "All", keep as-is unless your API returns longer history.
        window.__dashboardChartsData.profitTrend = { labels: fullLabels, data: fullData };
      } else {
        window.__dashboardChartsData.profitTrend = { labels: fullLabels, data: fullData };
      }

      if (typeof window.renderCharts === "function") window.renderCharts();
    }

    document.getElementById("btn6m")?.addEventListener("click", () => setRange("6m"));
    document.getElementById("btn12m")?.addEventListener("click", () => setRange("12m"));
    document.getElementById("btnAll")?.addEventListener("click", () => setRange("all"));

    // Refresh button (delegates to app.js listener if present; this is just a fallback)
    document.getElementById("refreshChartsBtn")?.addEventListener("click", () => {
      if (typeof window.renderCharts === "function") window.renderCharts();
    });
  </script>
</body>
</html>
